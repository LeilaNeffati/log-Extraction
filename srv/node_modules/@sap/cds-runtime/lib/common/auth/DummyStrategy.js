const cds = global.cds || require('@sap/cds/lib')

class DummyStrategy {
  constructor () {
    this.name = 'dummy'
  }

  authenticate (req) {
    let dummy
    // REVISIT: clean up once cds.PrivilegedUser is available
    const PrivilegedUser = cds.User.Privileged || cds.PrivilegedUser
    if (PrivilegedUser) {
      dummy = new PrivilegedUser()
    } else {
      dummy = new cds.User({ _is_privileged: true, id: 'privileged' })
      Object.defineProperty(dummy, 'is', {
        get () {
          return () => {
            return true
          }
        }
      })
    }
    // set _req for locale getter
    Object.defineProperty(dummy, '_req', { enumerable: false, value: req })

    this.success(dummy)
  }
}

module.exports = DummyStrategy
